---
layout: post
title: "Изменения в Selenide 2.10"
description: ""
category:
header-text: "Работа с окнами, DragAndDrop, JavaScript ошибки, поиск предков и обновление до Selenium 2.41.0"
tags: []
---
{% include JB/setup %}

Всем привет!

Недавно вышла версия Selenide 2.10. Что новенького нас ждёт?

## Новые функции

### Работа с вкладками и окнами

В Selenium WebDriver неудобно работать с окнами. Selenium предлагает только метод getWindowHandles(), который
возвращает множество (Set) строк - идентификаторов открытых окон. Найти среди них нужное - нетривиальная задача.
<br/>
<br/>
Поскольку задача Selenide - освободить голову программиста от технических вопросов, мы хотим сделать работу с
окнами/вкладками максимально простой и интуитивной. Начали мы с простого: добавили метод

```java
Selenide.switchToWindow(String title)
```

Пример использования можно подсмотреть [здесь](https://github.com/codeborne/selenide/blob/master/src/test/java/integration/TabsTest.java#LC45):

```java
@Test
  public void canSwitchToWindowByTitle() {
    $(byText("Page2: alerts")).click();
    $(byText("Page1: uploads")).click();

    switchToWindow("Test::alerts");
    $("h1").shouldHave(text("Page with alerts"));

    switchToWindow("Test::uploads");
    $("h1").shouldHave(text("File uploads"));
  }
```

У нас в планах продолжать работу в этом направлении. Возможно, с использованием новых фич из Java 8. 

А как вам было бы удобнее с окнами и фреймами? Делитесь своими идеями! 
<br/>
<br/>

### Новые методы для динамики `$.hover()` и `$.dragAndDropTo(target)`

<br/>
Метод `$.hover()` эмулирует наведение мышкой на элемент (без клика).
Примеры [здесь](https://github.com/codeborne/selenide/blob/master/src/test/java/integration/HoverTest.java).
<br/>
<br/>
А метод `$.dragAndDropTo(target)` позволяет перетащить элемент в другое место. Пример:

```java
  $("#from").dragAndDropTo("#to")
```

<br/>

### Новые методы для поиска родительских элементов $.parent() и $.closest()

Часто в тестах бывает удобно найти родительский элемент. Или даже не просто родительский, а ближайший потомок, соответствующий какому-то критерию.
Например, я часто ищу по тексту DIV, находящийся внутри таблицы, и затем хочу получить ряд таблицы, в котором этот DIV находится.
Раньше это иначе как через XPath сделать было невозможно.
<br/>
<br/>
Теперь можно писать так:

```java
  $(byText("Row 1")).parent();
  $(byText("Row 2")).closest("tr");
  $(By.name("firstName")).closest(".form");
```

Пример [здесь](https://github.com/codeborne/selenide/blob/master/src/test/java/integration/ParentTest.java)
<br/>
<br/>

### Ловля JavaScript ошибок
Теперь Selenide пытается автоматически отлавливать JavaScript ошибки, случающиеся на странице.
<br/>
<br/>
Что мы с ними делаем?
<br/>
<br/>
Прежде всего, когда ваш тест падает, Selenide автоматически **добавляет в сообщение об ошибке список JS ошибок** (если они были).
В принципе этого уже достаточно. Но если вы хотите большего контроля, есть два специальных метода:

* ```Selenide.getJavascriptErrors()``` - возвращает список всех ошибок на текущей странице.
* ```Selenide.assertNoJavascriptErrors()``` - валит тест, если были какие-то ошибки.

<br/>
P.S. Пока что это делается довольно просто (через функцию `window.onerror`). Она вроде как не во всех
браузерах работает, и не все ошибки отлавливает, так что если у вас есть соображения, как это можно делать
лучше - смело делитесь.

<br/>

## Багфиксы и улучшения

### Закрытие вебдрайверов
Механизм автоматического закрытия вебдрайверов был улучшен для случаев, когда вебдрайверов несколько, и один из них
завис. Спасибо Александру Гавриленко за это - совсем нетривиальное - исправление!

### Selenide больше не ждёт появления &lt;body&gt;

Метод `open(url)` больше не ждёт, пока в теле страницы появится тэг &lt;body&gt;.
Этот атавизм остался с тех давних пор, когда Selenide ещё умел ожидать наступления событий. 

### Метод savePageSourceToFile пытается закрыть все `alert`.

Когда в ходе выполнения теста на странице выскакивает неожиданный alert, грохается не только сам тест, но и попытка 
сделать скриншот, и даже попытка сохранить исходный код страницы.

Теперь Selenide после падения теста пытается закрыть все алерты, чтобы хоть как-то сохранить код страницы и скриншот. 
Ну чтобы хоть какая-то информация осталась.  
 
### Обновились до Selenium 2.41.0

Как обычно, мы обновились до последней версии Selenium.

Каких-то проблем с новым селениумом пока не замечено. Всё работает как часы.

## Другие новости

Мартовская статистика скачиваний Selenide из центрального репозитория несказанно нас порадовала.

Нас резко стало почти вдвое больше!

<center>
<img src="{{ BASE_PATH }}/images/2014/04/selenide_downloads.2014-03.png" width="800"/>
</center>


<br/>

А что у вас новенького?

<br/>